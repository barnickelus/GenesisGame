<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Genesis Evolution ‚Äî Biome Showcase</title>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<style>
 html,body{margin:0;height:100%;background:#060616;overflow:hidden;font-family:"Inter",Arial,sans-serif;}
 canvas{width:100%;height:100%;display:block;touch-action:none;background:#000;}
 #hud{position:fixed;top:14px;left:18px;color:#fff;font-size:15px;text-shadow:0 0 4px rgba(255,255,255,.3);z-index:2;}
 #compass{position:fixed;top:60px;left:18px;color:#aaa;font-size:12px;line-height:12px;letter-spacing:1px;text-shadow:0 0 2px #000;z-index:2;}
 #effBar{position:fixed;bottom:14px;left:18px;width:220px;height:18px;border-radius:9px;background:rgba(255,255,255,.12);z-index:2;}
 #effFill{width:100%;height:100%;border-radius:9px;background:#00e4b8;transition:background .4s;}
 #pauseBtn,#tiltBtn,#recBtn{position:fixed;top:14px;font-size:22px;color:#fff;cursor:pointer;user-select:none;z-index:2;}
 #pauseBtn{right:18px;}
 #tiltBtn{right:56px;}
 #recBtn{right:94px;}
 #radarWrap{position:fixed;top:48px;right:18px;width:70px;height:70px;display:none;z-index:2;}
 #radar{width:70px;height:70px;border:1px solid #555;border-radius:4px;background:rgba(0,0,0,.4);}
 #zoomSlider{position:fixed;top:130px;right:18px;width:70px;transform:rotate(-90deg);z-index:2;}
</style>
</head>
<body>
<canvas id="game"></canvas>

<div id="hud">Mass: <span id="mass">10</span>&nbsp; Score: <span id="score">0</span>&nbsp; <span id="level">1</span></div>
<div id="compass">N<br>E&nbsp;&nbsp;W<br>&nbsp;S</div>
<div id="effBar"><div id="effFill"></div></div>
<div id="pauseBtn">‚è∏Ô∏é</div><div id="tiltBtn">‚öôÔ∏é</div><div id="recBtn">üé¨</div>
<div id="radarWrap"><canvas id="radar" width="70" height="70"></canvas></div>
<input id="zoomSlider" type="range" min="0.5" max="2" step="0.01" value="1">

<!-- soundtrack stems -->
<audio id="bg0" src="background-music.mp3" loop preload="auto"></audio>
<audio id="bg1" src="layer1.mp3" loop preload="auto"></audio>
<audio id="bg2" src="layer2.mp3" loop preload="auto"></audio>

<!-- sfx -->
<audio id="eatSnd" src="eat.mp3" preload="auto"></audio>
<audio id="hurtSnd" src="hurt.mp3" preload="auto"></audio>
<audio id="frenzySnd" src="frenzy.mp3" preload="auto"></audio>

<script>
/* === SETTINGS & THEMES === */
const THEMES=[
 {bg:"#060616",star:"#222",accent:"#00e4b8",food:"#ff0"},
 {bg:"#001d2e",star:"#003742",accent:"#36ffe0",food:"#00ffea"},
 {bg:"#230024",star:"#301332",accent:"#ff00de",food:"#ff39ff"},
 {bg:"#0b001f",star:"#001a46",accent:"#00aaff",food:"#00d7ff"}
];
const BIOME_THRESH=[500,1000,1500];

/* === ORIGINAL CONSTANTS (trimmed for brevity, unchanged) === */
const MASS_THRESH=600,TITAN_LEVEL=10,TITAN_MAX=6,TITAN_RESPAWN_MS=20000,
SPECTRE_MAX=3,REAPER_MAX=3,C_RING_DIST=1600;
const SPECTRE_SPEED_MS=6000,SPECTRE_SPEED_MULT=1.25,
RADAR_PADDING=4,ZOOM_EASE=0.25;
const MASS_SPEED_FACTOR=0.0012,EXTRA_TAIL_PCT=0.10,MAX_TAIL_DRAW=60,
SAFE_PLAYER_MASS=70,BLINK_MS=300;

/* === CANVAS === */
const canvas=document.getElementById("game"),ctx=canvas.getContext("2d",{alpha:false});
ctx.imageSmoothingEnabled=false;let W,H;function resize(){W=canvas.width=innerWidth;H=canvas.height=innerHeight;}resize();addEventListener("resize",resize);

/* === INPUT & TILT === */
let sliderZoom=1,zoom=1;document.getElementById("zoomSlider").oninput=e=>sliderZoom=parseFloat(e.target.value);
const toWorld=e=>({x:(e.clientX-offset.x)/zoom,y:(e.clientY-offset.y)/zoom});
let useTilt=false;const tiltBtn=document.getElementById("tiltBtn");tiltBtn.onclick=()=>{useTilt=!useTilt;tiltBtn.style.opacity=useTilt?0.6:1;};
let tiltVec={x:0,y:0};
if(window.DeviceOrientationEvent)window.addEventListener("deviceorientation",e=>{
 if(!useTilt)return;
 const beta=e.beta||0,gamma=e.gamma||0;
 tiltVec.x=gamma/30;tiltVec.y=beta/30;
});

/* === RECORDING === */
const recBtn=document.getElementById("recBtn");let recMedia,recChunks=[];recBtn.onclick=()=>{if(!recMedia)return;recMedia.requestData();};
async function initRecorder(){
 if(!("MediaRecorder"in window))return;
 const stream=canvas.captureStream(60);recMedia=new MediaRecorder(stream,{mimeType:"video/webm"});
 recMedia.ondataavailable=e=>{recChunks.push(e.data);if(recChunks.length>200){recChunks.shift();}}
 recMedia.start(100); /* 100 ms chunks ‚Äì keeps ~20 s buffer */
}
initRecorder();

/* === HUD refs === */
const massEl=document.getElementById("mass"),scoreEl=document.getElementById("score"),levelEl=document.getElementById("level"),
effFill=document.getElementById("effFill"),pauseBtn=document.getElementById("pauseBtn"),
radarWrap=document.getElementById("radarWrap"),rctx=document.getElementById("radar").getContext("2d");

/* === WORLD === */
let player={x:0,y:0,r:15,mass:10,tail:[],baseSpeed:2.5,blink:0,speedBoost:0};
let target={x:0,y:0,active:false},offset={x:0,y:0};
const food=[],foes=[],titans=[],spectres=[],reapers=[],beacons=[];
let pill={x:0,y:0,r:10,active:false,cd:0};
let frenzy=false,F_TIME=0;
let paused=false,radarActive=false;
const STARS=120,stars=[...Array(STARS)].map(()=>({x:Math.random()*4000-2000,y:Math.random()*4000-2000,s:Math.random()*1.5+0.5}));

/* === AUDIO === */
const layers=[...["bg0","bg1","bg2"].map(id=>document.getElementById(id))];
function playLayers(){layers.forEach(a=>{a.loop=true;a.volume=0;a.play().catch(()=>{});});layers[0].volume=0.6;}
function fadeLayer(idx,to,spd=0.002){layers[idx].volume=Math.max(0,Math.min(1,lerp(layers[idx].volume,to,spd)));}
addEventListener("pointerdown",()=>playLayers(),{once:true});

/* === HELPERS === */
const rand=v=>Math.random()*v-v/2;
const dist=(a,b,c,d)=>Math.hypot(a-c,b-d);
const onScreen=(x,y,r)=>!(x+r<player.x-W/(2*zoom)||x-r>player.x+W/(2*zoom)||y+r<player.y-H/(2*zoom)||y-r>player.y+H/(2*zoom));
const lerp=(a,b,t)=>a+(b-a)*t;
const rgb=h=>({r:parseInt(h.slice(1,3),16),g:parseInt(h.slice(3,5),16),b:parseInt(h.slice(5,7),16)});
const mixHex=(a,b,t)=>{const A=rgb(a),B=rgb(b);return`rgb(${Math.round(lerp(A.r,B.r,t))},${Math.round(lerp(A.g,B.g,t))},${Math.round(lerp(A.b,B.b,t))})`;};

/* === PARTICLES etc. (unchanged functions omitted for brevity) === */
const particles=[];function spawnBurst(x,y,c){for(let i=0;i<12;i++)particles.push({x,y,dx:rand(2),dy:rand(2),r:3,ttl:600,col:c});}

/* === EXISTING SPAWN code (unchanged)‚Ä¶ === */
function spawnFood(){while(food.length<60)food.push({x:rand(1800),y:rand(1800),r:6});}
function spawnFoe(){foes.push({x:rand(2000),y:rand(2000),r:(player.mass>=MASS_THRESH?14:10)+Math.random()*20});}
/* ‚Ä¶spawnTitan, Spectre, Reaper, Pill etc., unchanged ‚Ä¶ */

/* initial entities */
spawnFood();for(let i=0;i<12;i++)spawnFoe();
["N","S","E","W"].forEach(d=>{const p={N:[0,-C_RING_DIST],S:[0,C_RING_DIST],E:[C_RING_DIST,0],W:[-C_RING_DIST,0]}[d];beacons.push({x:p[0],y:p[1],r:18});});

/* === INPUT HANDLERS === */
canvas.addEventListener("pointerdown",e=>{if(paused)return;const p=toWorld(e);target=({x:p.x,y:p.y,active:true});});
canvas.addEventListener("pointermove",e=>{if(target.active&&!paused){const p=toWorld(e);target.x=p.x;target.y=p.y;}});
canvas.addEventListener("pointerup",()=>target.active=false);
pauseBtn.onclick=()=>{paused=!paused;pauseBtn.textContent=paused?"‚ñ∂Ô∏é":"‚è∏Ô∏é";layers.forEach(a=>paused?a.pause():a.play().catch(()=>{}));};

/* === DRAW HELPERS (glow etc.) unchanged === */
function glow(x,y,r,c,a){if(r*zoom<0.8||!onScreen(x,y,r))return;ctx.globalAlpha=a;ctx.shadowBlur=12*zoom;ctx.shadowColor=c;ctx.fillStyle=c;ctx.beginPath();ctx.arc(x,y,r,0,Math.PI*2);ctx.fill();ctx.shadowBlur=0;ctx.globalAlpha=1;}

/* === GAME LOOP === */
let last=0,bgIdx=0;
function loop(ts){
 if(paused){last=ts;return requestAnimationFrame(loop);}
 const dt=(ts-last)||16;last=ts;

 /* biome check */
 const nextIdx=BIOME_THRESH.findIndex(th=>player.mass<th)+1;bgIdx=nextIdx<0?THEMES.length-1:nextIdx;
 const theme=THEMES[bgIdx];document.body.style.background=theme.bg;effFill.style.background=theme.accent;

 /* soundtrack fade */
 fadeLayer(1,bgIdx>=2?0.7:0);fadeLayer(2,bgIdx>=3?0.6:0);

 /* zoom ease */
 zoom=lerp(zoom,Math.min(sliderZoom,Math.max(0.5,H/(player.r*4))),ZOOM_EASE);

 /* input vector */
 if(useTilt&&Math.hypot(tiltVec.x,tiltVec.y)>0.1){target.active=true;
   target.x=player.x+tiltVec.x*500;target.y=player.y+tiltVec.y*500;}

 /* movement & decay (original maths) */
 const vx=(target.active?target.x:player.x)-player.x,vy=(target.active?target.y:player.y)-player.y,vLen=Math.hypot(vx,vy);
 if(player.speedBoost>0)player.speedBoost=Math.max(0,player.speedBoost-dt);
 const sp=player.baseSpeed*(player.speedBoost>0?SPECTRE_SPEED_MULT:1)*(frenzy?1.3:1)*(1+player.mass*MASS_SPEED_FACTOR);
 if(vLen>1){player.x+=vx/vLen*sp;player.y+=vy/vLen*sp;}
 player.mass=Math.max(5,player.mass-(0.000009*player.r*player.r+(player.mass<150?0.002:0.003))*dt);

 /* camera */
 offset.x=W/2-player.x*zoom;offset.y=H/2-player.y*zoom;

 /* STARFIELD */
 ctx.setTransform(1,0,0,1,0,0);ctx.fillStyle=theme.bg;ctx.fillRect(0,0,W,H);
 ctx.fillStyle=theme.star;for(const s of stars){const sx=(s.x-player.x*0.1)*zoom+offset.x,sy=(s.y-player.y*0.1)*zoom+offset.y;if(sx<0||sx>W||sy<0||sy>H)continue;ctx.fillRect(sx,sy,s.s,s.s);}

 /* world transform */
 ctx.setTransform(zoom,0,0,zoom,offset.x,offset.y);

 /* == ALL EXISTING GAME LOGIC (food, foes, titans, spectres, reapers, pill, frenzy, beacons, particles, radar) stays exactly as in your last build.  Replace those blocks here verbatim. == */

 /* HUD final update */
 massEl.textContent=player.mass.toFixed(0);scoreEl.textContent=Math.floor(player.mass*10);levelEl.textContent=Math.floor(player.mass/100)+1;

 requestAnimationFrame(loop);
}
requestAnimationFrame(loop);
</script>
</body>
</html>